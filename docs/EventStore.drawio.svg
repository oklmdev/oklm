<svg host="65bd71144e" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="911px" height="1131px" viewBox="-0.5 -0.5 911 1131" content="&lt;mxfile&gt;&lt;diagram id=&quot;BOLXNHBWRqvgZMgqzaPF&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;">
    <defs/>
    <g>
        <path d="M 260 70 L 528.98 76.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 534.23 76.49 L 527.15 79.83 L 528.98 76.37 L 527.32 72.83 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="140" y="40" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 70px; margin-left: 141px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                Use Case
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="200" y="74" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Use Case
                </text>
            </switch>
        </g>
        <path d="M 490 30 L 490 30 L 910 30 L 910 30" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 490 30 L 490 500 L 910 500 L 910 30" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 490 30 L 910 30" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 198px; height: 1px; padding-top: 55px; margin-left: 271px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                transaction(aggregateId, callback)
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="370" y="59" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    transaction(aggregateId, callback)
                </text>
            </switch>
        </g>
        <path d="M 830 75 C 830 66.72 843.43 60 860 60 C 867.96 60 875.59 61.58 881.21 64.39 C 886.84 67.21 890 71.02 890 75 L 890 285 C 890 293.28 876.57 300 860 300 C 843.43 300 830 293.28 830 285 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 890 75 C 890 83.28 876.57 90 860 90 C 843.43 90 830 83.28 830 75" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 193px; margin-left: 831px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                Store
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="860" y="196" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Store
                </text>
            </switch>
        </g>
        <path d="M 690 88 L 823.63 87.52" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 828.88 87.5 L 821.89 91.03 L 823.63 87.52 L 821.87 84.03 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 75px; margin-left: 701px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                lock aggregateId
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="755" y="79" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    lock aggregateId
                </text>
            </switch>
        </g>
        <path d="M 828.98 122.04 L 666.37 120.53" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 661.12 120.48 L 668.15 117.04 L 666.37 120.53 L 668.09 124.04 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 105px; margin-left: 735px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                getEvents(aggregatedId)
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="764" y="109" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    getEvents(...
                </text>
            </switch>
        </g>
        <path d="M 540 60 L 540 60 L 690 60 L 690 60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 540 60 L 540 340 L 690 340 L 690 60" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 540 60 L 690 60" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 120px; margin-left: 610px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: nowrap;">
                                callback(events)
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="610" y="124" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    callback(events)
                </text>
            </switch>
        </g>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 170px; margin-left: 566px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                pending events
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="610" y="174" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    pending events
                </text>
            </switch>
        </g>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 45px; margin-left: 601px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                transaction
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="630" y="49" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    transaction
                </text>
            </switch>
        </g>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 165px; margin-left: 701px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                save(pending events)
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="760" y="169" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    save(pending events)
                </text>
            </switch>
        </g>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 265px; margin-left: 551px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                publish
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="580" y="269" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    publish
                </text>
            </switch>
        </g>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 215px; margin-left: 701px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                commit / unlock
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="755" y="219" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    commit / unlock
                </text>
            </switch>
        </g>
        <path d="M 691.05 231.92 L 823.63 232.47" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 828.88 232.5 L 821.87 235.97 L 823.63 232.47 L 821.9 228.97 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 690 270 L 820.63 268.17" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/>
        <path d="M 825.88 268.1 L 818.93 271.69 L 820.63 268.17 L 818.83 264.69 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 285px; margin-left: 701px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                rollback
                                <br/>
                                if failure
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="755" y="289" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    rollback...
                </text>
            </switch>
        </g>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 94px; height: 1px; padding-top: 15px; margin-left: 545px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                Event Store
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="592" y="19" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Event Store
                </text>
            </switch>
        </g>
        <path d="M 608 129 L 608 153.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 608 158.88 L 604.5 151.88 L 608 153.63 L 611.5 151.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 610 180 L 823.63 180" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 828.88 180 L 821.88 183.5 L 823.63 180 L 821.88 176.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <rect x="390" y="260" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 290px; margin-left: 391px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                Event Bus
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="450" y="294" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Event Bus
                </text>
            </switch>
        </g>
        <path d="M 610 185 L 514.39 285.39" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <path d="M 510.77 289.19 L 513.06 281.71 L 514.39 285.39 L 518.13 286.54 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 362px; height: 1px; padding-top: 190px; margin-left: 5px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 680px; overflow: hidden;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                <h1>
                                    EventStore.publish ?
                                </h1>
                                <p>
                                    Est-ce que c'est possible de faire un publish directement sur l'event store ? Ou bien doit-on toujours passer par une transaction ?
                                </p>
                                <p>
                                    Il y a des événements qui n'ont pas d'aggregateId. Il n'y a donc pas de notion de lock.
                                </p>
                                <p>
                                    Parfois, on veut juste publier un événement sans charger d'agrégat. Pas besoin de récupérer les événements.
                                </p>
                                <p>
                                    Est-ce qu'on peut émettre un événement d'un agrégat sans passer par celui-ci ? Ca parait contre-intuitif. Si un événement est publié avec une aggregateId alors il faut nécessairement acquérir un lock sur cet aggregateId (pour ne pas interférer avec une transaction sur un agrégat (race condition).
                                </p>
                                <p>
                                    Si un événement peut avoir plusieurs aggregateIds, alors on doit ouvrir une transaction sur l'ensemble de ces agrégats ? Il faut un lock sur chaque aggregateId dont l'événement va être émis pour éviter la race condition.
                                </p>
                                <p>
                                    Lorsqu'on ouvre une transaction, on n'a l'aggregateId seulement de l'agrégat qui nous intéresse. Les autres agrégats ne peuvent être lockés que lorsque nous savons quels événements publier. Il risque d'y avoir des transactions simultanées qui se bloquent mutuellement. Ou bien, le premier lock est bloquant mais les locks sur les aggregateIds secondaires sont non-bloquants: si le lock est déjà utilisé, la transaction échoue.
                                </p>
                                <p>
                                    On peut imaginer un eventStore.publish qui regarde l'aggregateId des événements à publier et tente d'acquérir un lock dessus. Si le lock est déjà pris, ça échoue sans attendre qu'il se libère.
                                </p>
                                <p>
                                    <br/>
                                </p>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="5" y="202" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">
                    EventStore.publish ?...
                </text>
            </switch>
        </g>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 332px; height: 1px; padding-top: 510px; margin-left: 475px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 620px; overflow: hidden;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">
                                <h1>
                                    Store
                                </h1>
                                <p>
                                    lock(aggregateId): obtient un lock, quitte à attendre qu'il soit dispo
                                </p>
                                <p>
                                    getEvents(aggregateId): récupère tous les événements pour un aggregateId donné
                                </p>
                                <p>
                                    tryLock(aggregateId): tente d'obtenir un lock, échoue s'il n'est pas dispo
                                </p>
                                <p>
                                    save(events): persiste une série d'événements
                                </p>
                                <p>
                                    NB: tryLock n'est utilisé que dans le contexte d'un save(events), il n'est donc pas forcément accessible de l'extérieur.
                                </p>
                                <p>
                                    NB: Pour conserver le contexte bas-niveau (ex: transaction postgres), on peut imaginer que toutes ces méthodes soient disponibles via une fonction transaction(aggregateId, callback: ({ events, save }) =&gt; void)
                                </p>
                                <p>
                                    <span>
                                        transaction: (aggregateId, callback) =&gt; {
                                        <br/>
                                    </span>
                                    <span>
                                        <span style="white-space: pre">
                                        </span>
                                        // open transaction
                                        <br/>
                                    </span>
                                    <span>
                                        <span style="white-space: pre">
                                        </span>
                                        // lock on aggregateId (wait if necessary)
                                        <br/>
                                        <span style="white-space: pre">
                                        </span>
                                        // get events for aggregateId
                                        <br/>
                                        <span style="white-space: pre">
                                        </span>
                                        const save = (events) =&gt; {
                                        <br/>
                                        <span style="white-space: pre">
                                        </span>
                                        <span style="white-space: pre">
                                        </span>
                                        // gets aggregateIds from events
                                        <br/>
                                        <span style="white-space: pre">
                                        </span>
                                        <span style="white-space: pre">
                                        </span>
                                        // check if more locks needed (other than aggregateId)
                                        <br/>
                                        <span style="white-space: pre">
                                        </span>
                                        <span style="white-space: pre">
                                        </span>
                                        // try to get lock on the other aggregateIds (fail immédiately if not available
                                        <br/>
                                        <span style="white-space: pre">
                                        </span>
                                        }
                                        <br/>
                                    </span>
                                    <span>
                                        <span style="white-space: pre">
                                        </span>
                                        await callback(events, save)
                                    </span>
                                    <span>
                                        <br/>
                                        <span style="white-space: pre">
                                        </span>
                                        // release locks
                                        <br/>
                                        <span style="white-space: pre">
                                        </span>
                                        // commit transaction
                                        <br/>
                                    </span>
                                    <span>
                                        }
                                    </span>
                                    <span>
                                        <br/>
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="475" y="522" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">
                    Store...
                </text>
            </switch>
        </g>
    </g>
    <switch>
        <g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/>
        <a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank">
            <text text-anchor="middle" font-size="10px" x="50%" y="100%">
                Viewer does not support full SVG 1.1
            </text>
        </a>
    </switch>
</svg>